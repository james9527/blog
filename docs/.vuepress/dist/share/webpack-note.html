<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack随手记 | james9527的前端日志</title>
    <meta name="description" content="欢迎访问我的前端日志~">
    <link rel="icon" href="https://github.githubassets.com/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
    
    <link rel="preload" href="/assets/css/0.styles.50972fb1.css" as="style"><link rel="preload" href="/assets/js/app.243f5bcb.js" as="script"><link rel="preload" href="/assets/js/2.9f793532.js" as="script"><link rel="preload" href="/assets/js/23.5ddcef71.js" as="script"><link rel="prefetch" href="/assets/js/10.89c3f046.js"><link rel="prefetch" href="/assets/js/11.016745ab.js"><link rel="prefetch" href="/assets/js/12.cb68ab2f.js"><link rel="prefetch" href="/assets/js/13.deaed419.js"><link rel="prefetch" href="/assets/js/14.50753450.js"><link rel="prefetch" href="/assets/js/15.58e3f2eb.js"><link rel="prefetch" href="/assets/js/16.1d86b9a4.js"><link rel="prefetch" href="/assets/js/17.e1a6cda2.js"><link rel="prefetch" href="/assets/js/18.346bf1f9.js"><link rel="prefetch" href="/assets/js/19.78240e60.js"><link rel="prefetch" href="/assets/js/20.9f8112a8.js"><link rel="prefetch" href="/assets/js/21.949c88d9.js"><link rel="prefetch" href="/assets/js/22.ed756214.js"><link rel="prefetch" href="/assets/js/24.b2c436b7.js"><link rel="prefetch" href="/assets/js/25.261db367.js"><link rel="prefetch" href="/assets/js/26.5581b1a0.js"><link rel="prefetch" href="/assets/js/27.bf6b4055.js"><link rel="prefetch" href="/assets/js/28.4e29b192.js"><link rel="prefetch" href="/assets/js/29.f58efee5.js"><link rel="prefetch" href="/assets/js/3.c060a925.js"><link rel="prefetch" href="/assets/js/30.9f012d81.js"><link rel="prefetch" href="/assets/js/4.146b5933.js"><link rel="prefetch" href="/assets/js/5.1358bfcc.js"><link rel="prefetch" href="/assets/js/6.fe752fd6.js"><link rel="prefetch" href="/assets/js/7.36d98635.js"><link rel="prefetch" href="/assets/js/8.c7e7690c.js"><link rel="prefetch" href="/assets/js/9.6acd8702.js">
    <link rel="stylesheet" href="/assets/css/0.styles.50972fb1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">james9527的前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随手记系列" class="dropdown-title"><span class="title">随手记系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/share/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/share/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/share/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/share/webpack-note.html" class="nav-link router-link-exact-active router-link-active">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/share/wechat.html" class="nav-link">公众号开发总结</a></li><li class="dropdown-item"><!----> <a href="/share/scaffold.html" class="nav-link">深入浅出前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/share/javascript-basic.html" class="nav-link">前端基础JS系列</a></li><li class="dropdown-item"><!----> <a href="/share/optimize.html" class="nav-link">移动端性能优化(一)</a></li><li class="dropdown-item"><!----> <a href="/share/optimize2.html" class="nav-link">移动端性能优化(二)</a></li><li class="dropdown-item"><!----> <a href="/share/md.html" class="nav-link">markdown语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作相关" class="dropdown-title"><span class="title">工作相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/skulpt/1.html" class="nav-link">深入skulpt</a></li><li class="dropdown-item"><!----> <a href="/scratch/links.html" class="nav-link">深入scratch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机英语" class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/webpack.html" class="nav-link">webpack 英文</a></li><li class="dropdown-item"><!----> <a href="/en/npm.html" class="nav-link">npm 英文</a></li><li class="dropdown-item"><!----> <a href="/en/skulpt.html" class="nav-link">skulpt 英文</a></li><li class="dropdown-item"><!----> <a href="/en/scratch.html" class="nav-link">scratch 英文</a></li><li class="dropdown-item"><!----> <a href="/en/ecma.html" class="nav-link">ecma 英文</a></li></ul></div></div><div class="nav-item"><a href="/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/james9527" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随手记系列" class="dropdown-title"><span class="title">随手记系列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/share/eslint.html" class="nav-link">eslint规则</a></li><li class="dropdown-item"><!----> <a href="/share/opt.html" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/share/webpack.html" class="nav-link">深入webpack</a></li><li class="dropdown-item"><!----> <a href="/share/webpack-note.html" class="nav-link router-link-exact-active router-link-active">webpack随手记</a></li><li class="dropdown-item"><!----> <a href="/share/wechat.html" class="nav-link">公众号开发总结</a></li><li class="dropdown-item"><!----> <a href="/share/scaffold.html" class="nav-link">深入浅出前端脚手架</a></li><li class="dropdown-item"><!----> <a href="/share/javascript-basic.html" class="nav-link">前端基础JS系列</a></li><li class="dropdown-item"><!----> <a href="/share/optimize.html" class="nav-link">移动端性能优化(一)</a></li><li class="dropdown-item"><!----> <a href="/share/optimize2.html" class="nav-link">移动端性能优化(二)</a></li><li class="dropdown-item"><!----> <a href="/share/md.html" class="nav-link">markdown语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工作相关" class="dropdown-title"><span class="title">工作相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/skulpt/1.html" class="nav-link">深入skulpt</a></li><li class="dropdown-item"><!----> <a href="/scratch/links.html" class="nav-link">深入scratch</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机英语" class="dropdown-title"><span class="title">计算机英语</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/webpack.html" class="nav-link">webpack 英文</a></li><li class="dropdown-item"><!----> <a href="/en/npm.html" class="nav-link">npm 英文</a></li><li class="dropdown-item"><!----> <a href="/en/skulpt.html" class="nav-link">skulpt 英文</a></li><li class="dropdown-item"><!----> <a href="/en/scratch.html" class="nav-link">scratch 英文</a></li><li class="dropdown-item"><!----> <a href="/en/ecma.html" class="nav-link">ecma 英文</a></li></ul></div></div><div class="nav-item"><a href="/url/fe.html" class="nav-link">常用网址</a></div><div class="nav-item"><a href="https://github.com/james9527" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Webpack随手记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/share/webpack-note.html#简述下webpack的构建流程" class="sidebar-link">简述下Webpack的构建流程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#tree-shaking的理解" class="sidebar-link">Tree Shaking的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#scope-hoisting的理解" class="sidebar-link">Scope Hoisting的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#code-splitting的理解" class="sidebar-link">Code Splitting的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#file-loader和url-loader的区别" class="sidebar-link">file-loader和url-loader的区别</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#聊聊热更新的实现" class="sidebar-link">聊聊热更新的实现</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#webpack-dev-server的理解" class="sidebar-link">webpack-dev-server的理解</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#文件名hash值" class="sidebar-link">文件名hash值</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/share/webpack-note.html#vue-cli中webpack相关配置" class="sidebar-link">vue-cli中webpack相关配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/share/webpack-note.html#webpack-dev-conf-js" class="sidebar-link">webpack.dev.conf.js</a></li><li class="sidebar-sub-header"><a href="/share/webpack-note.html#webpack-base-conf-js" class="sidebar-link">webpack.base.conf.js</a></li><li class="sidebar-sub-header"><a href="/share/webpack-note.html#config-index-js" class="sidebar-link">config/index.js</a></li><li class="sidebar-sub-header"><a href="/share/webpack-note.html#utils-js" class="sidebar-link">utils.js</a></li><li class="sidebar-sub-header"><a href="/share/webpack-note.html#build-js" class="sidebar-link">build.js</a></li><li class="sidebar-sub-header"><a href="/share/webpack-note.html#webpack-prod-conf" class="sidebar-link">webpack.prod.conf</a></li></ul></li><li><a href="/share/webpack-note.html#webpack工具整理" class="sidebar-link">webpack工具整理</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack随手记"><a href="#webpack随手记" class="header-anchor">#</a> Webpack随手记</h1> <blockquote><p>本文记录了一些webpack的核心功能，包含名词解释以及使用场景等，欢迎大家补充...</p></blockquote> <h2 id="简述下webpack的构建流程"><a href="#简述下webpack的构建流程" class="header-anchor">#</a> 简述下Webpack的构建流程</h2> <ol><li>初始化：启动构建，读取与合并配置参数，加载相应的Plugins，实例化Compiler；</li> <li>编译：从entry出发，针对每个module串行调用对应的loader去翻译文件内容，再找到该module依赖的module，递归地进行编译处理；</li> <li>输出：对编译后的module组合成chunk，再把chunk转换成文件，输出到output指定目录下；</li></ol> <h2 id="tree-shaking的理解"><a href="#tree-shaking的理解" class="header-anchor">#</a> Tree Shaking的理解</h2> <blockquote><p>你可以将应用程序想象为一棵树。实际使用的源代码和库表示树的绿色活叶，死亡代码代表了被秋天消耗掉的棕色枯叶。为了除掉枯叶，你必须摇动这棵树，使它们落下，这就是所谓的“摇树优化”。</p></blockquote> <p>Webpack4里，配置参数mode为production(即生产环境)时，默认开启了Tree Shaking功能，若值为none则关闭了Tree Shaking。例如值引用了loadsh的isEqual方法，打包时只打引用过的模块。所以，我们为了利用<a href="https://webpack.js.org/guides/tree-shaking/#root" target="_blank" rel="noopener noreferrer">Tree Shaking<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的优势，建议如下：</p> <ul><li>使用ES2015模块语法（如import 和 export）；</li> <li>确保没有编译器将ES2015模块语法转换为CommonJS模块（这是流行的babel preset@babel/preset env的默认行为-有关详细信息，<a href="https://www.babeljs.cn/docs/babel-preset-env" target="_blank" rel="noopener noreferrer">请参阅文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）；</li> <li>将”sideEffects“(副作用)属性添加到项目的package.json文件中；</li> <li>使用生产模式配置选项启用各种优化，包括压缩和Tree Shaking；</li></ul> <h2 id="scope-hoisting的理解"><a href="#scope-hoisting的理解" class="header-anchor">#</a> Scope Hoisting的理解</h2> <blockquote><p>原理：将所有模块的代码按照引用顺序放在一个函数作用域里 ，然后适当的重命名一些变量以防止变量名冲突。通过scope hoisting可减少函数声明代码合内存开销。</p></blockquote> <p>如果不开启scope hoisting，会导致大量作用域包裹代码，导致体积增大（模块越多越明显），运行代码时创建的函数作用域变多（大量的IIFE匿名闭包），内存开销大。</p> <ul><li>Webpack4环境，配置参数mode为production(即生产环境)时，默认开启了scope hoisting功能。</li> <li>Webpack3环境，需要在plugins里手动配置，<code>new webpack.optimize.ModuleConcatenationPlugin()</code>，会将es6里的import转换成__webpack__require__，export转换成__webpack_exports__。</li></ul> <h2 id="code-splitting的理解"><a href="#code-splitting的理解" class="header-anchor">#</a> Code Splitting的理解</h2> <blockquote><p>代码拆分是Webpack最引人注目的特性之一。此功能允许您将代码拆分为各种捆绑包，然后可以按需或并行加载。它可以用来实现更小的捆绑包和控制资源负载优先级，如果正确使用，这会对加载时间产生重大影响。</p></blockquote> <p>有三种通用的代码拆分方法：</p> <ol><li>入口点：使用入口配置手动拆分代码。</li> <li>防止重复：使用SplitChunksPlugin来删除和拆分块。</li> <li>动态导入：通过模块内的内联函数调用拆分代码。</li></ol> <h2 id="file-loader和url-loader的区别"><a href="#file-loader和url-loader的区别" class="header-anchor">#</a> file-loader和url-loader的区别</h2> <blockquote><p>url-loader内部使用了file-loader，都可以处理图片和字体，不过url-loader还可以将较小资源转化成base64字符串。</p></blockquote> <ul><li>file-loader：文件加载器将文件的import/require()解析为URL，并将文件发送到输出目录。</li> <li>url-loader：用于将文件转换为base64 URI的Webpack加载程序。</li></ul> <h2 id="聊聊热更新的实现"><a href="#聊聊热更新的实现" class="header-anchor">#</a> 聊聊热更新的实现</h2> <blockquote><p>本话题主要想讲webpack-dev-server 与 hot-module-replacement-plugin之间的关系，需要从两者的功能上来分析说明。</p></blockquote> <p>单独写两个包也是出于功能的解耦来考虑的。简单来说就是：hot-module-replacement-plugin 包给 webpack-dev-server 提供了热更新的能力。</p> <ul><li>webpack-dev-server(WDS)的功能提供 bundle server的能力，就是生成的 bundle.js 文件可以通过 localhost://xxx 的方式去访问，另外 WDS 也提供 livereload(浏览器的自动刷新)。</li> <li>hot-module-replacement-plugin 的作用是提供 HMR 的 runtime，并且将 runtime 注入到 bundle.js 代码里面去。一旦磁盘里面的文件修改，那么 HMR server 会将有修改的 js module 信息发送给 HMR runtime，然后 HMR runtime 去局部更新页面的代码。因此这种方式可以不用刷新浏览器。</li></ul> <h2 id="webpack-dev-server的理解"><a href="#webpack-dev-server的理解" class="header-anchor">#</a> webpack-dev-server的理解</h2> <blockquote><p>webpack-dev-server 是webpack-dev-middleware的封装版，细聊一下webpack-dev-middleware灵活的场景？</p></blockquote> <ul><li>webpack-dev-server实际上相当于启用了一个express的Http服务器+调用webpack-dev-middleware。它的作用主要是用来伺服资源文件。这个Http服务器和client使用了websocket通讯协议，原始文件作出改动后，webpack-dev-server会用webpack实时的编译，再用webpack-dev-middleware将webpack编译后文件会输出到内存中。适合纯前端项目，很难编写后端服务，进行整合。</li> <li>webpack-dev-middleware输出的文件存在于内存中。你定义了 webpack.config，webpack 就能据此梳理出entry和output模块的关系脉络，而 webpack-dev-middleware 就在此基础上形成一个文件映射系统，每当应用程序请求一个文件，它匹配到了就把内存中缓存的对应结果以文件的格式返回给你，反之则进入到下一个中间件。</li></ul> <h2 id="文件名hash值"><a href="#文件名hash值" class="header-anchor">#</a> 文件名hash值</h2> <ul><li>hash，如果都使用hash的话，因为这是工程级别的，即每次修改任何一个文件，所有文件名的hash至都将改变。所以一旦修改了任何一个文件，整个项目的文件缓存都将失效。</li> <li>chunkhash，它可根据不同的入口文件(Entry)进行依赖文件解析、构建对应的chunk，生成对应的哈希值。在生产环境里把一些公共库和程序入口文件区分开，单独打包构建，接着我们采用chunkhash的方式生成哈希值，那么只要我们不改动公共库的代码，就可以保证其哈希值不会受影响，并且webpack4中支持了异步import功能。</li> <li>contenthash，它是针对文件内容级别的，只有你自己模块的内容变了，那么hash值才改变。</li></ul> <h2 id="vue-cli中webpack相关配置"><a href="#vue-cli中webpack相关配置" class="header-anchor">#</a> vue-cli中webpack相关配置</h2> <h3 id="webpack-dev-conf-js"><a href="#webpack-dev-conf-js" class="header-anchor">#</a> webpack.dev.conf.js</h3> <blockquote><p>该文件是开发环境中webpack的配置入口。</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 工具函数集合</span>
<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token comment">// 配置文件</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack 配置合并插件</span>
<span class="token keyword">var</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack基本配置</span>
<span class="token keyword">var</span> baseWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.conf'</span><span class="token punctuation">)</span>
<span class="token comment">// 自动生成 html 并且注入到 .html 文件中的插件</span>
<span class="token comment">// https://github.com/ampedandwired/html-webpack-plugin</span>
<span class="token keyword">var</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack错误信息提示插件</span>
<span class="token comment">// https://github.com/geowarin/friendly-errors-webpack-plugin</span>
<span class="token keyword">var</span> FriendlyErrorsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">// 将 Hot-reload 热重载的客户端代码添加到 webpack.base.conf 的 对应 entry 中，一起打包</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>baseWebpackConfig<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  baseWebpackConfig<span class="token punctuation">.</span>entry<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'./build/dev-client'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>baseWebpackConfig<span class="token punctuation">.</span>entry<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseWebpackConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// styleLoaders</span>
    rules<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">styleLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sourceMap<span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>cssSourceMap <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 最新的配置为 cheap-module-eval-source-map，虽然 cheap-module-eval-source-map更快，但它的定位不准确</span>
  <span class="token comment">// 所以，换成 eval-source-map</span>
  devtool<span class="token punctuation">:</span> <span class="token string">'#eval-source-map'</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// definePlugin 接收字符串插入到代码当中, 所以你需要的话可以写上 JS 的字符串</span>
    <span class="token comment">// 此处，插入适当的环境</span>
    <span class="token comment">// https://webpack.js.org/plugins/define-plugin/</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">'process.env'</span><span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>env
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// HotModule 插件在页面进行变更的时候只会重绘对应的页面模块，不会重绘整个 html 文件</span>
    <span class="token comment">// https://github.com/glenjamin/webpack-hot-middleware#installation--usage</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NoEmitOnErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 将 index.html 作为入口，注入 html 代码后生成 index.html文件</span>
    <span class="token comment">// https://github.com/ampedandwired/html-webpack-plugin</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token punctuation">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      template<span class="token punctuation">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      inject<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">//默认值，script标签位于html文件的 body 底部</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// webpack错误信息提示插件</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="webpack-base-conf-js"><a href="#webpack-base-conf-js" class="header-anchor">#</a> webpack.base.conf.js</h3> <blockquote><p>这个文件是开发环境和生产环境，甚至测试环境，这些环境的公共webpack配置。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// node自带的文件路径工具</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// 工具函数集合</span>
<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
  <span class="token comment">// 配置文件</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span>
  <span class="token comment">// 工具函数集合</span>
<span class="token keyword">var</span> vueLoaderConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./vue-loader.conf'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 获得绝对路径
 * @method resolve
 * @param  {String} dir 相对于本文件的路径
 * @return {String}     绝对路径
 */</span>
<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">:</span> <span class="token string">'./src/main.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 编译输出的静态资源根路径</span>
    path<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span>
    <span class="token comment">// 编译输出的文件名</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    <span class="token comment">// 正式发布环境下编译输出的上线路径的根路径</span>
    publicPath<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span> <span class="token operator">?</span>
      config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsPublicPath <span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsPublicPath
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 自动补全的扩展名</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.vue'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 路径别名</span>
    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 例如 import Vue from 'vue'，会自动到 'vue/dist/vue.common.js'中寻找</span>
      <span class="token string">'vue$'</span><span class="token punctuation">:</span> <span class="token string">'vue/dist/vue.esm.js'</span><span class="token punctuation">,</span>
      <span class="token string">'@'</span><span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token comment">// 审查 js 和 vue 文件</span>
        <span class="token comment">// https://github.com/MoOx/eslint-loader</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(js|vue)$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
        <span class="token comment">// 表示预先处理</span>
        enforce<span class="token punctuation">:</span> <span class="token string">&quot;pre&quot;</span><span class="token punctuation">,</span>
        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          formatter<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'eslint-friendly-formatter'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 处理 vue文件</span>
        <span class="token comment">// https://github.com/vuejs/vue-loader</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'vue-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> vueLoaderConfig
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 编译 js</span>
        <span class="token comment">// https://github.com/babel/babel-loader</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 处理图片文件</span>
        <span class="token comment">// https://github.com/webpack-contrib/url-loader</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpe?g|gif|svg)(\?.*)?$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          limit<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
          name<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'img/[name].[hash:7].[ext]'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 处理字体文件</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.(woff2?|eot|ttf|otf)(\?.*)?$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          limit<span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
          name<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'fonts/[name].[hash:7].[ext]'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="config-index-js"><a href="#config-index-js" class="header-anchor">#</a> config/index.js</h3> <blockquote><p>是主要的配置文件，包含静态文件的路径、是否开启sourceMap等。其中，分为两个部分<code>dev</code>（开发环境的配置）和<code>build</code>（生产环境的配置）。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 详情见文档：https://vuejs-templates.github.io/webpack/env.html</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// production 生产环境</span>
  build<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建环境</span>
    env<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./prod.env'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 构建输出的index.html文件</span>
    index<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 构建输出的静态资源路径</span>
    assetsRoot<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 构建输出的二级目录</span>
    assetsSubDirectory<span class="token punctuation">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
    <span class="token comment">// 构建发布的根目录，可配置为资源服务器域名或 CDN 域名</span>
    assetsPublicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否开启 cssSourceMap</span>
    productionSourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// Gzip off by default as many popular static hosts such as</span>
    <span class="token comment">// Surge or Netlify already gzip all static assets for you.</span>
    <span class="token comment">// Before setting to `true`, make sure to:</span>
    <span class="token comment">// npm install --save-dev compression-webpack-plugin</span>
    <span class="token comment">// 默认关闭 gzip，因为很多流行的静态资源主机，例如 Surge、Netlify，已经为所有静态资源开启gzip</span>
    productionGzip<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment">// 需要使用 gzip 压缩的文件扩展名</span>
    productionGzipExtensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// Run the build command with an extra argument to</span>
    <span class="token comment">// View the bundle analyzer report after build finishes:</span>
    <span class="token comment">// `npm run build --report`</span>
    <span class="token comment">// Set to `true` or `false` to always turn it on or off</span>
    <span class="token comment">// 运行“build”命令行时，加上一个参数，可以在构建完成后参看包分析报告</span>
    <span class="token comment">// true为开启，false为关闭</span>
    bundleAnalyzerReport<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>npm_config_report
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// dev 开发环境</span>
  dev<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建环境</span>
    env<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./dev.env'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 端口号</span>
    port<span class="token punctuation">:</span> <span class="token number">3333</span><span class="token punctuation">,</span>
    <span class="token comment">// 是否自动打开浏览器</span>
    autoOpenBrowser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    assetsSubDirectory<span class="token punctuation">:</span> <span class="token string">'static'</span><span class="token punctuation">,</span>
    <span class="token comment">// 编译发布的根目录，可配置为资源服务器域名或 CDN 域名</span>
    assetsPublicPath<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
    <span class="token comment">// proxyTable 代理的接口（可跨域）</span>
    <span class="token comment">// 使用方法：https://vuejs-templates.github.io/webpack/proxy.html</span>
    proxyTable<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// CSS Sourcemaps off by default because relative paths are &quot;buggy&quot;</span>
    <span class="token comment">// with this option, according to the CSS-Loader README</span>
    <span class="token comment">// (https://github.com/webpack/css-loader#sourcemaps)</span>
    <span class="token comment">// In our experience, they generally work as expected,</span>
    <span class="token comment">// just be aware of this issue when enabling this option.</span>
    <span class="token comment">// 默认情况下，关闭 CSS Sourcemaps，因为使用相对路径会报错。</span>
    <span class="token comment">// CSS-Loader README：https://github.com/webpack/css-loader#sourcemaps</span>
    cssSourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="utils-js"><a href="#utils-js" class="header-anchor">#</a> utils.js</h3> <blockquote><p>也是一个被使用频率的文件，这个文件包含了三个工具函数：</p></blockquote> <ul><li>生成静态资源的路径</li> <li>生成 ExtractTextPlugin对象或loader字符串</li> <li>生成 style-loader的配置</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// node自带的文件路径工具</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// 配置文件</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span>
<span class="token comment">// 提取css的插件</span>
<span class="token comment">// https://github.com/webpack-contrib/extract-text-webpack-plugin</span>
<span class="token keyword">var</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">/**
 * 生成静态资源的路径
 * @method assertsPath
 * @param  {String}    _path 相对于静态资源文件夹的文件路径
 * @return {String}          静态资源完整路径
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">assetsPath</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">_path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> assetsSubDirectory <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span>
    <span class="token operator">?</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsSubDirectory
    <span class="token punctuation">:</span> config<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>assetsSubDirectory
    <span class="token comment">//  path.posix.join与path.join一样，不过总是以 posix 兼容的方式交互</span>
  <span class="token keyword">return</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>assetsSubDirectory<span class="token punctuation">,</span> _path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 生成处理css的loaders配置
 * @method cssLoaders
 * @param  {Object}   options 生成配置
 *                            option = {
 *                              // 是否开启 sourceMap
 *                              sourceMap: true,
 *                              // 是否提取css
 *                              extract: true
 *                            }
 * @return {Object}           处理css的loaders配置对象
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">cssLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">var</span> cssLoader <span class="token operator">=</span> <span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      minimize<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
      sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/**
   * 生成 ExtractTextPlugin对象或loader字符串
   * @method generateLoaders
   * @param  {Array}        loaders loader名称数组
   * @return {String|Object}        ExtractTextPlugin对象或loader字符串
   */</span>
  <span class="token keyword">function</span> <span class="token function">generateLoaders</span> <span class="token punctuation">(</span><span class="token parameter">loader<span class="token punctuation">,</span> loaderOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> loaders <span class="token operator">=</span> <span class="token punctuation">[</span>cssLoader<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      loaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// 例如，sass?indentedSyntax</span>
        <span class="token comment">// 在?号前加上“-loader”</span>
        loader<span class="token punctuation">:</span> loader <span class="token operator">+</span> <span class="token string">'-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> loaderOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>sourceMap
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// extract为true时，提取css</span>
    <span class="token comment">// 生产环境中，默认为true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>extract<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        use<span class="token punctuation">:</span> loaders<span class="token punctuation">,</span>
        fallback<span class="token punctuation">:</span> <span class="token string">'vue-style-loader'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">'vue-style-loader'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>loaders<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// http://vuejs.github.io/vue-loader/en/configurations/extract-css.html</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    css<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    postcss<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    less<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    sass<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> indentedSyntax<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    scss<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'sass'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    stylus<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'stylus'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    styl<span class="token punctuation">:</span> <span class="token function">generateLoaders</span><span class="token punctuation">(</span><span class="token string">'stylus'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 生成 style-loader的配置
 * style-loader文档：https://github.com/webpack/style-loader
 * @method styleLoaders
 * @param  {Object}     options 生成配置
 *                              option = {
 *                                // 是否开启 sourceMap
 *                                sourceMap: true,
 *                                // 是否提取css
 *                                extract: true
 *                              }
 * @return {Array}              style-loader的配置
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">styleLoaders</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> output <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> loaders <span class="token operator">=</span> exports<span class="token punctuation">.</span><span class="token function">cssLoaders</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> extension <span class="token keyword">in</span> loaders<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> loader <span class="token operator">=</span> loaders<span class="token punctuation">[</span>extension<span class="token punctuation">]</span>
    output<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'\\.'</span> <span class="token operator">+</span> extension <span class="token operator">+</span> <span class="token string">'$'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span> loader
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> output
<span class="token punctuation">}</span>
</code></pre></div><h3 id="build-js"><a href="#build-js" class="header-anchor">#</a> build.js</h3> <blockquote><p>该文件，为构建打包文件，会将源码进行构建（编译、压缩等）后打包。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 设置当前环境为生产环境</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">=</span> <span class="token string">'production'</span>

<span class="token comment">// loading 插件</span>
<span class="token comment">// https://github.com/sindresorhus/ora</span>
<span class="token keyword">var</span> ora <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ora'</span><span class="token punctuation">)</span>
<span class="token comment">// 可以在 node 中执行`rm -rf`的工具</span>
<span class="token comment">// https://github.com/isaacs/rimraf</span>
<span class="token keyword">var</span> rm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rimraf'</span><span class="token punctuation">)</span>
<span class="token comment">// node自带的文件路径工具</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// 在终端输出带颜色的文字</span>
<span class="token comment">// https://github.com/chalk/chalk</span>
<span class="token keyword">var</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token comment">// 配置文件</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.prod.conf'</span><span class="token punctuation">)</span>

<span class="token comment">// 在终端显示loading效果，并输出提示</span>
<span class="token keyword">var</span> spinner <span class="token operator">=</span> <span class="token function">ora</span><span class="token punctuation">(</span><span class="token string">'building for production...'</span><span class="token punctuation">)</span>
spinner<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 删除这个文件夹 （递归删除）</span>
<span class="token function">rm</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsSubDirectory<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
  <span class="token comment">// 构建</span>
  <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 构建成功</span>

    <span class="token comment">// 停止 loading动画</span>
    spinner<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err
    process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      colors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      modules<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      children<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      chunkModules<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n\n'</span><span class="token punctuation">)</span>

    <span class="token comment">// 打印提示</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">'  Build complete.\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>
      <span class="token string">'  Tip: built files are meant to be served over an HTTP server.\n'</span> <span class="token operator">+</span>
      <span class="token string">'  Opening index.html over file:// won\'t work.\n'</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="webpack-prod-conf"><a href="#webpack-prod-conf" class="header-anchor">#</a> webpack.prod.conf</h3> <blockquote><p>该文件，为生产环境中webpack的配置入口。同时，它也依赖于前面提到的<code>webpack.base.conf.js</code>、<code>utils.js</code>和<code>config/index.js</code>。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// node自带的文件路径工具</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">// 工具函数集合</span>
<span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
<span class="token comment">// 配置文件</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack 配置合并插件</span>
<span class="token keyword">var</span> merge <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack 基本配置</span>
<span class="token keyword">var</span> baseWebpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.conf'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack 复制文件和文件夹的插件</span>
<span class="token comment">// https://github.com/kevlened/copy-webpack-plugin</span>
<span class="token keyword">var</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">// 自动生成 html 并且注入到 .html 文件中的插件</span>
<span class="token comment">// https://github.com/ampedandwired/html-webpack-plugin</span>
<span class="token keyword">var</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">// 提取css的插件</span>
<span class="token comment">// https://github.com/webpack-contrib/extract-text-webpack-plugin</span>
<span class="token keyword">var</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token comment">// webpack 优化压缩和优化 css 的插件</span>
<span class="token comment">// https://github.com/NMFR/optimize-css-assets-webpack-plugin</span>
<span class="token keyword">var</span> OptimizeCSSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>

<span class="token comment">// 如果当前环境为测试环境，则使用测试环境</span>
<span class="token comment">// 否则，使用生产环境</span>
<span class="token keyword">var</span> env <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'testing'</span>
  <span class="token operator">?</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../config/test.env'</span><span class="token punctuation">)</span>
  <span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>env

<span class="token keyword">var</span> webpackConfig <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span>baseWebpackConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// styleLoaders</span>
    rules<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">styleLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      sourceMap<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionSourceMap<span class="token punctuation">,</span>
      extract<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 是否开启 sourceMap</span>
  devtool<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionSourceMap <span class="token operator">?</span> <span class="token string">'#source-map'</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 编译输出的静态资源根路径</span>
    path<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsRoot<span class="token punctuation">,</span>
    <span class="token comment">// 编译输出的文件名</span>
    filename<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'js/[name].[chunkhash].js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 没有指定输出名的文件输出的文件名</span>
    chunkFilename<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'js/[id].[chunkhash].js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// definePlugin 接收字符串插入到代码当中, 所以你需要的话可以写上 JS 的字符串</span>
    <span class="token comment">// 此处，插入适当的环境</span>
    <span class="token comment">// http://vuejs.github.io/vue-loader/en/workflow/production.html</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">'process.env'</span><span class="token punctuation">:</span> env
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 压缩 js</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        warnings<span class="token punctuation">:</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      sourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 提取 css</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token punctuation">:</span> utils<span class="token punctuation">.</span><span class="token function">assetsPath</span><span class="token punctuation">(</span><span class="token string">'css/[name].[contenthash].css'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 压缩提取出来的 css</span>
    <span class="token comment">// 可以删除来自不同组件的冗余代码</span>
    <span class="token comment">// Compress extracted CSS. We are using this plugin so that possible</span>
    <span class="token comment">// duplicated CSS from different components can be deduped.</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 将 index.html 作为入口，注入 html 代码后生成 index.html文件</span>
    <span class="token comment">// https://github.com/ampedandwired/html-webpack-plugin</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'testing'</span>
        <span class="token operator">?</span> <span class="token string">'index.html'</span>
        <span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>index<span class="token punctuation">,</span>
      template<span class="token punctuation">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        removeAttributeQuotes<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token comment">// 更多选项 https://github.com/kangax/html-minifier#options-quick-reference</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 必须通过 CommonsChunkPlugin一致地处理多个 chunks</span>
      chunksSortMode<span class="token punctuation">:</span> <span class="token string">'dependency'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 分割公共 js 到独立的文件</span>
    <span class="token comment">// https://webpack.js.org/guides/code-splitting-libraries/#commonschunkplugin</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'vendor'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">minChunks</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> count</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// node_modules中的任何所需模块都提取到vendor</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
          module<span class="token punctuation">.</span>resource <span class="token operator">&amp;&amp;</span>
          <span class="token regex">/\.js$/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>resource<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          module<span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>
            path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../node_modules'</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 将webpack runtime 和模块清单 提取到独立的文件，以防止当 app包更新时导致公共 jsd hash也更新</span>
    <span class="token comment">// extract webpack runtime and module manifest to its own file in order to</span>
    <span class="token comment">// prevent vendor hash from being updated whenever app bundle is updated</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token punctuation">:</span> <span class="token string">'manifest'</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'vendor'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 复制静态资源</span>
    <span class="token comment">// https://github.com/kevlened/copy-webpack-plugin</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../static'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        to<span class="token punctuation">:</span> config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>assetsSubDirectory<span class="token punctuation">,</span>
        ignore<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.*'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 开启 gzip 的情况时，给 webpack plugins添加 compression-webpack-plugin 插件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionGzip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// webpack 压缩插件</span>
    <span class="token comment">// https://github.com/webpack-contrib/compression-webpack-plugin</span>
  <span class="token keyword">var</span> CompressionWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span>

  <span class="token comment">// 向webpackconfig.plugins中加入下方的插件</span>
  webpackConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">CompressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      asset<span class="token punctuation">:</span> <span class="token string">'[path].gz[query]'</span><span class="token punctuation">,</span>
      algorithm<span class="token punctuation">:</span> <span class="token string">'gzip'</span><span class="token punctuation">,</span>
      test<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
        <span class="token string">'\\.('</span> <span class="token operator">+</span>
        config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>productionGzipExtensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span> <span class="token operator">+</span>
        <span class="token string">')$'</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      threshold<span class="token punctuation">:</span> <span class="token number">10240</span><span class="token punctuation">,</span>
      minRatio<span class="token punctuation">:</span> <span class="token number">0.8</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 开启包分析的情况时， 给 webpack plugins添加 webpack-bundle-analyzer 插件</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>bundleAnalyzerReport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// https://github.com/th0r/webpack-bundle-analyzer</span>
  <span class="token keyword">var</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin
  webpackConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpackConfig
</code></pre></div><hr> <h2 id="webpack工具整理"><a href="#webpack工具整理" class="header-anchor">#</a> webpack工具整理</h2> <ul><li><strong>wbpack-bundle-analyzer</strong> （ 动态化显示打包js大小 ）</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1</span>、在<span class="token keyword">package</span><span class="token punctuation">.</span>json加入这行命令 “analyz”<span class="token punctuation">:</span> “<span class="token constant">NODE_ENV</span><span class="token operator">=</span>production npm_config_report<span class="token operator">=</span><span class="token boolean">true</span> npm run build”

<span class="token number">2</span>、安装webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer  cnpm install <span class="token operator">--</span>save<span class="token operator">-</span>dev webpack<span class="token operator">-</span>bundle<span class="token operator">-</span>analyzer

<span class="token number">3</span>、在webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js里增加如下代码

  <span class="token keyword">var</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin<span class="token punctuation">;</span>

 	<span class="token comment">// ...</span>

 plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

	<span class="token comment">// ...</span>

<span class="token number">4</span>、另一种写法 （webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js）
  <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>build<span class="token punctuation">.</span>bundleAnalyzerReport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> BundleAnalyzerPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-bundle-analyzer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>BundleAnalyzerPlugin
    webpackConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BundleAnalyzerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token number">5</span>、运行analyz  npm run analyz 默认会打开 <span class="token punctuation">[</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8888</span><span class="token punctuation">]</span><span class="token punctuation">(</span>http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token regex">/127.0.0.1:8888/</span><span class="token punctuation">)</span> 作为展示
</code></pre></div><ul><li><p>config/index.js中 build下</p> <p>productionSourceMap:true 改为 false // 否则生产环境可以看到源码</p> <p>productionGzip: false,  // true 开启gzip压缩</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>		<span class="token comment">// 在设置为 `true`之前, 确保安装了compression-webpack-plugin开发依赖</span>
    <span class="token comment">// npm install --save-dev compression-webpack-plugin</span>
    productionGzip<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    productionGzipExtensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.243f5bcb.js" defer></script><script src="/assets/js/2.9f793532.js" defer></script><script src="/assets/js/23.5ddcef71.js" defer></script>
  </body>
</html>
